å®˜ç½‘å’Œç½‘ä¸Šå…¶ä»–æ•™ç¨‹ä¸æ¸…ä¸æ¥šçš„ï¼Œæµªè´¹æˆ‘å¥½å‡ ä¸ªå°æ—¶ï¼ï¼ï¼
ç‰¹æ­¤è®°å½•ä¸€ä¸‹
---
**æ›´æ–°è¯´æ˜**
ç¬¬ä¸€æ¬¡é…ç½®æˆåŠŸåï¼Œç”±äºæ²¡æœ‰æ­£ç¡®é€€å‡ºclash,ç¬¬äºŒæ¬¡å¯åŠ¨åå®Œå…¨å¤±æ•ˆï¼ï¼ï¼
é—®é¢˜è¯´æ˜åŠè§£å†³åŠæ³•è§ç¬¬äº”ä¸ªå‘

# 1. ä¸‹è½½å®¢æˆ·ç«¯

 1. ~~[åˆ›å»º`clash`æ–‡ä»¶å¤¹ä»¥å­˜æ”¾åé¢æ‰€éœ€çš„æ‰€æœ‰æ–‡ä»¶]~~
    > æ›´æ–°æ³¨ï¼šå»ºè®®å°†ä»¥ä¸‹æ–‡ä»¶å­˜æ”¾åœ¨`/usr/loal/bin`ç›®å½•ä¸‹ï¼Œè¿™æ ·å¯ä»¥åœ¨å…¨å±€ä»»æ„ç›®å½•æ‰§è¡Œ`clash`

 2. [ä¸‹è½½ClashäºŒè¿›åˆ¶æ–‡ä»¶](https://github.com/Dreamacro/clash/releases)
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/d04292718a244ffe8619883fe5f637a3.png)
ä¸ªäºº64ä½ç”µè„‘ä¸‹è½½**clash-linux-amd64-v1.16.0.gz**å³å¯(æˆ‘ä¸‹è½½åœ¨`Downloads`ç›®å½•)
 3. å°†å…¶è§£å‹ç¼©å¹¶é‡å‘½åä¸ºclash
   ```
   gzip clash-linux-amd64-v1.16.0.gz
   mv ./clash-linux-amd64-v1.16.0 /usr/loal/bin
   cd /usr/loal/bin
   mv clash-linux-amd64-v1.16.0 clash
   ```

# 2.  ä¸‹è½½clashé…ç½®æ–‡ä»¶
åœ¨ç»ˆç«¯ cd åˆ° clash äºŒè¿›åˆ¶æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼Œæ‰§è¡Œ`wget -O config.yml http://***`

> è¯´æ˜ï¼šhttp://**æ˜¯ä»£ç†ç½‘ç«™çš„SSRé“¾æ¥

> **è¸©çš„ç¬¬ä¸€ä¸ªå‘ï¼šæ‰§è¡Œè¯­å¥åï¼Œæ–°ç”Ÿæˆçš„`config.yml`æ–‡ä»¶å¹¶æ²¡æœ‰ä¸‹è½½ä¸‹æ¥ä»»ä½•ä¸œè¥¿ã€‚**
> è§£å†³åŠæ³•ï¼šåˆ‡æ¢æˆrootç”¨æˆ·ï¼Œé‡æ–°æ‰§è¡Œè¯¥è¯­å¥ã€‚

åœ¨æ–‡ä»¶å¤¹ä¸‹å‡ºç°äº†ä¸¤ä¸ªæ–°æ–‡ä»¶ï¼š`config.yml`å’Œ`wget-log`
# 3. å¯åŠ¨clash

```
./clash -d .
```
> **è¸©çš„ç¬¬äºŒä¸ªå‘ï¼šæç¤º*permission denied***
> è§£å†³åŠæ³•ï¼šè¿è¡Œæƒé™`chmod +x clash`

> **è¸©çš„ç¬¬ä¸‰ä¸ªå‘ï¼šæç¤º`Canâ€˜t find MMDB, start downloadé”™è¯¯`**
> è¯´æ˜ï¼šæŒ‰ç†è¯´ï¼Œå®ƒåº”è¯¥è‡ªå·±ä¸‹è½½MMDBæ–‡ä»¶ï¼Œä½†ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¸‹è½½ä¸äº†ï¼Œæ‰€ä»¥éœ€è¦æˆ‘æ‰‹åŠ¨ä¸‹è½½
> è§£å†³åŠæ³•ï¼š1. [ä¸‹è½½MMDBæ–‡ä»¶](https://gitee.com/dnqbob/sp_engine/blob/SPcn-01-02-20/GeoLite2-Country.mmdb.gz)ï¼Œè§£å‹ç¼©å¹¶é‡å‘½åä¸º`Country.mmdb`</p>
> 2. å†æ¬¡æ‰§è¡Œ`./clash -d .`

> **è¸©çš„ç¬¬å››ä¸ªå‘ï¼šæ–°ç”Ÿæˆäº†`config.yaml`æ–‡ä»¶, æ‰“å¼€åªæœ‰ä¸€æ¡å†…å®¹ï¼š`mixed port: xxxx`**

> **è¯´æ˜ï¼šçœŸçš„æ— è¯­ï¼Œå®˜ç½‘ä¸ä¼šå†™æ•™ç¨‹å°±ä¸è¦å†™ï¼Œç«Ÿç„¶æ¼äº†æœ€é‡è¦çš„ä¸€æ­¥ï¼š
> æŠŠé…ç½®æ–‡ä»¶`config.yml`çš„å†…å®¹æ›¿æ¢åˆ°`config.yaml`æ–‡ä»¶é‡Œé¢ï¼ï¼ï¼**

æœ€åä¸¤æ­¥ï¼š
1. åœ¨ubuntuç³»ç»Ÿè®¾ç½®ç½‘ç»œè¿æ¥ä¸­é…ç½®ä»£ç†ï¼š
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/f44cfc2c8ffa49209ae4f260ed0b4781.png)
networkproxyæ”¹ä¸ºæ‰‹åŠ¨ï¼Œå‚ç…§`config.yml`æ–‡ä»¶å†…å®¹å¦‚å›¾é…ç½®ï¼š
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/0c216ca9fe3b4f13a593593d4066bc4c.png)
> è¯´æ˜ï¼šæ¯ä¸ªäººçš„ä»£ç†æœåŠ¡ä¸åŒï¼Œå…·ä½“è®¾ç½®è¯·æŸ¥çœ‹æ‰€è´­ä¹°æœåŠ¡çš„ç½‘ç«™è¯´æ˜

2. ç„¶åå†æ¬¡å¯åŠ¨clash: 

ç»ˆç«¯è¾“å…¥ï¼š
```
./clash -d .
```

ç»ˆç«¯çª—å£å‡ºç°ï¼š

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/b4fa45ba28db450c9edaa5d7ba23316c.png)

> **è‡³æ­¤æˆåŠŸï¼**

ç”¨acccmip6ä¸‹è½½æ•°æ®ç®€ç›´èµ·é£
![Screenshot from 2023-06-21 10-58-36](https://github.com/70iscoolest/ubuntu-proxy-clash/assets/91779073/76dcdc32-f5f6-4158-8492-c80fcc15170b)

---------------------------------------------------------------------------------------------------------------------------------------------

æˆ‘ä»¥ä¸ºè¿™å°±æˆåŠŸäº†ï¼Œç»“æœç¬¬äºŒæ¬¡æ‰“å¼€`clash`ï¼Œè¿æ¥ä¸äº†å¤–ç½‘ï¼Œå‚»çœ¼äº†ï¼Œç½‘ä¸Šæ‰¾éäº†ä¹Ÿè¯•éäº†ï¼Œå®Œå…¨ä¸çŸ¥é“ä¸ºå•¥ã€‚

åˆæäº†ä¸€å¤©ğŸ‘ºğŸ‘ºğŸ‘ºï¼Œç»ˆäºè§£å†³äº†ï¼š

> å…¶å®ç°åœ¨ä¹Ÿä¸å¤ªçŸ¥é“å…·ä½“æ˜¯ä»€ä¹ˆåŸå› ï¼Œåªèƒ½è¿›è¡Œä¸€äº›æ¨æµ‹

1. é¦–å…ˆå¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ç½‘é¡µç‰ˆçš„`clash-board`ï¼Œå‘ç°å®ƒä¸€ç›´å¼¹å‡ºexternal controllor(å¤–éƒ¨æ§åˆ¶)ï¼š
![](./pics/external_control.png)

- ç‚¹ç¡®å®šå’Œæ·»åŠ å¼¹çª—ä¹Ÿä¸æ¶ˆå¤±ï¼Œä¸çŸ¥é“å•¥æ„æ€

2. æŸ¥çœ‹`~/.config/clash`ç›®å½•ä¸‹çš„`confi.yaml`æ–‡ä»¶ï¼ˆç¬¬ä¸‰æ­¥å·²ç»é…ç½®å¥½äº†ï¼‰

- å…³äº`external controllor`çš„éƒ¨åˆ†ï¼š
![](./pics/yamlec.png)

- 9090å°±æ˜¯å¤–éƒ¨æ§åˆ¶çš„å‡ºå£ï¼Œè¿™ä¸¤ä¸ªè¦å¯¹åº”èµ·æ¥ã€‚
- secretä¸€å¼€å§‹æ˜¯ç©ºç™½çš„ï¼Œéœ€è¦è‡ªè¡Œè®¾ç½®ã€‚
- æˆ‘æ‰‹åŠ¨åœ¨`confi.yaml`ä¸­æ·»åŠ 1111è¿™ä¸ªå¯†é’¥ï¼Œä¿å­˜åå†æ¬¡å¯åŠ¨`clash`
- é‚£ä¹ˆåœ¨`clash-board`ä¸­ï¼Œä¹Ÿå¯¹åº”å¡«secretæ˜¯1111
![](./pics/yamlec2.png)

3. è¿™ä¸ªæ—¶å€™ä¹Ÿæ²¡æœ‰æˆåŠŸï¼Œå‘ç°`clash-board`logä¸€ç‰‡ç©ºç™½ï¼Œè¯´æ˜æ²¡æœ‰æµé‡ç»è¿‡`clash`
4. å†ä¿®æ”¹`confi.yaml`æ–‡ä»¶ä¸­çš„`log-level=debug`ï¼Œé‡æ–°å¯åŠ¨`clash`ï¼Œè®©ç»ˆç«¯è¾“å‡ºé”™è¯¯ä¿¡æ¯
![](./pics/debug.png)

- ç¬¬ä¸€ä¸ªé”™è¯¯ï¼š`Start HTTP server error: listen tcp :7890: bind: address already in use`
  > è§£å†³åŠæ³•ï¼š
  > 1. æ‰“å¼€å¦å¤–çš„ç»ˆç«¯è¾“å…¥`sudo lsof -i tcp:7890`æŸ¥çœ‹å“ªäº›è¿›ç¨‹å ç”¨è¿™ä¸ªç«¯å£
  ![](./pics/portinuse.png)
  è¿™ä¸€çœ‹ä¸å¾—äº†ï¼Œæ€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¤šè¿›ç¨‹å ç”¨è¿™ä¸ªç«¯å£ï¼Ÿ
  > 2. è¾“å…¥`sudo kill -9 XXXX #PID`æ€æ­»è¿™äº›è¿›ç¨‹

- ç¬¬äºŒä¸ªé”™è¯¯: `WARN[0000] Failed to start Redir UDP Listener: operation not permitted`
  > è§£å†³åŠæ³•ï¼š
  > è¾“å…¥`sudo setcap cap_net_bind_service,cap_net_admin+ep /path/to/clash`

- ç¬¬ä¸‰ä¸ªé”™è¯¯:`ERRO[0000] Start Redir server error: operation not permitted'
  > ä¸å¤ªç¡®å®šè¿™æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œå¥½åƒåœ¨è¾“å…¥äº†ä¸Šé¢ä¸€ä¸ªè¯­å¥ä¹‹åï¼Œè¿™ä¸ªé—®é¢˜å°±æ¶ˆå¤±äº†

  > å¦‚æœä¸è¡Œï¼Œå°è¯•ä¿®æ”¹ç³»ç»Ÿæ—¶é—´
  ```
  sudo systemctl restart systemd-timesyncd.service
  ```

# ç»ˆäºè§£å†³ï¼ï¼ˆå¸Œæœ›è¿™æ¬¡æ˜¯çœŸçš„è§£å†³äº†ğŸ‘Šï¼‰


 
